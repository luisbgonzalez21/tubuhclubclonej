"use strict";(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[66,8930],{47044:function(e,t,a){a.r(t),a.d(t,{ProtectedPagesApiSymbol:function(){return S},page:function(){return N},site:function(){return y}});var s,n=a(56510),r=a(25259),o=a(18358);!function(e){e.SM="SM",e.Pass="PASS",e.NONE="NONE"}(s||(s={}));const i=(0,n.ff)([(0,n.t6)(r.jC,o.u),(0,n.t6)(r.R9,o.u),(0,n.t6)(r.Wf,o.u)],((e,t,a)=>{const n=a=>{const n=e.pagesSecurity[a];return n&&n.requireLogin?s.SM:t.passwordProtected[a]||n&&n.passwordDigest?s.Pass:s.NONE};return{async handle(t){if(t.pageJsonFileName)return t;const r=t.pageId,{pagesMap:o,loginAndNavigate:i,authenticateUsingSitePassword:u,completedSitePasswordAuth:g}=a.get();if(o[r])return{...t,pageJsonFileName:o[r]};if(n("masterPage")===s.Pass&&!g)return u(t),null;const p=n(r);return p===s.NONE&&((e,t)=>{throw new Error(`we do not have authentication info for protected page ${e} page security: ${t}`)})(r,e.pagesSecurity[r]),i(t,p),null}}}));var u=a(75471),g=a(6504),p=a(50997),c=a(58382),d=a(2922),P=a(21980),l=a(24888);const f=(0,n.ff)([(0,n.t6)(r.Wf,o.u),(0,n.t6)(r.R9,o.u),(0,n.t6)(r.jC,o.u),u.F0,d.jj,(0,n.jt)(p.n9),(0,n.jt)(c.RC),P.EE,l.O],((e,{publicPageIds:t,pageUriSeoToRouterPrefix:a},{customNoPermissionsPageUriSeo:n,customNoPermissionsPageId:r},o,i,u,p,c,d)=>{const P=async(e,t)=>e===s.SM?(async()=>{let e;if(u)if(d["specs.thunderbolt.newAuthorizedPagesFlow"]){if(e=await u.requestAuthorizedPages(),e.success)return{authorizedPagesMap:e.pages}}else if(e=await u.requestAuthentication({}),e.success)return{authorizedPagesMap:await u.authorizeMemberPagesByToken(e.token)};return{authorizedPagesMap:{},authenticationResult:e}})():(async e=>p?p.promptPagePasswordDialog(e):{authorizedPagesMap:{}})(t),l=async(e,t,s=!1)=>{if(n&&s){const t=`${a[n]?`./${a[n]}/`:"./"}${n}`;return o.navigate(`${t}?appSectionParams=${JSON.stringify({restrictedPageId:e.pageId,restrictedPagePath:(e.relativeEncodedUrl??"").replace("./","/")})}`)}if(u&&"SM"===t){const e=()=>{i.isLandingOnProtectedPage()&&o.navigate("./")};return u.showNoPermissionsToPageDialog(e),!1}return!!i.isLandingOnProtectedPage()&&o.navigate("./")};async function f(t){if(!p)return;const{authorizedPagesMap:a,onComplete:s}=await p.promptSitePasswordDialog();e.update((e=>({...e,pagesMap:Object.assign(e.pagesMap,a),completedSitePasswordAuth:!0}))),await o.navigate(t.parsedUrl.href),s?.()}const h=async(a,s)=>{const n=a.pageId;try{const{authorizedPagesMap:u,authenticationResult:p,onProtectedPageNavigationComplete:c}=await P(s,n);if(e.update((e=>({...e,pagesMap:Object.assign(e.pagesMap,u)}))),p?.reason===g.$9.CANCELED)return!!i.isLandingOnProtectedPage()&&o.navigate("./");if(u[n]){const e=await o.navigate(a.parsedUrl.href);return c?.(),e}{const n=t.includes(r),o=Boolean(e.get().pagesMap[r]);return l(a,s,n||o)}}catch(e){return c.captureError(e,{tags:{feature:"protectedPage"}}),l(a,s)}};return e.update((()=>({loginAndNavigate:h,authenticateUsingSitePassword:f,completedSitePasswordAuth:!1,pagesMap:{}}))),{appWillMount:async()=>{}}}));var h=a(13487),w=a(46450);const M=(0,n.ff)([(0,n.t6)(r.Wf,o.u),p.n9],((e,t)=>({getTpaHandlers(){return{authorizeMemberPages:async()=>{const a=await t.authorizeMemberPagesByCookie();e.update((e=>({...e,pagesMap:{...e.pagesMap,...a}})))}}}})));const m=(0,n.ff)([(0,n.t6)(r.Wf,o.u)],(function(e){return{getPageJsonFileName(t){return e.get()?.pagesMap[t]??null}}})),S=Symbol("ProtectedPagesApiSymbol"),y=e=>{e(u.BD.Protected).to(i),e(h.j.AppWillMountHandler).to(f),e(S).to(m)},N=e=>{e(w.go).to(M)}}}]);
//# sourceMappingURL=https://static.parastorage.com/services/wix-thunderbolt/dist/protectedPages.a187ac64.chunk.min.js.map